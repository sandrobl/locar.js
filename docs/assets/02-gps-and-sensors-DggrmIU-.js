import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import{P as b,W as M,S,B as C,a as G,M as F,L as N,E as A,b as O}from"./three.module-jZqFDccH.js";import{L as R,H as T,x as W}from"./locar.es-CLGu3crh.js";const v={latitude:47.41047675920058,longitude:9.332869851461123},l=5,_=[16724838,16762173,5231045,3711337,6717162,16156595],$=.6,r=new b(80,window.innerWidth/window.innerHeight,.001,1e3),u=new M({canvas:document.getElementById("glscene")});u.setSize(window.innerWidth,window.innerHeight);const d=new S,i=new R(d,r),L=new T({video:{facingMode:"environment"}},null);L.on("webcamstarted",e=>{d.background=e.texture});L.on("webcamerror",e=>{alert(`Webcam error: code ${e.code} message ${e.message}`)});window.addEventListener("resize",()=>{u.setSize(window.innerWidth,window.innerHeight),r.aspect=window.innerWidth/window.innerHeight,r.updateProjectionMatrix()});let E=!0,a=!1,n=null;const t={latitude:v.latitude,longitude:v.longitude};let c=null;const m=new W(r);m.on("deviceorientationgranted",e=>{e.target.connect()});m.on("deviceorientationerror",e=>{alert(`Device orientation error: code ${e.code} message ${e.message}`)});m.init();i.on("gpserror",e=>{alert(`GPS error: ${e.code}`)});i.on("gpsupdate",e=>{E&&(alert(`Got the initial location: longitude ${e.position.coords.longitude}, latitude ${e.position.coords.latitude}`),E=!1),K(e.position.coords.latitude,e.position.coords.longitude),a?x():(n=h(),i.add(n,t.longitude,t.latitude),a=!0,g())});i.startGps();const P=document.getElementById("fakeLat"),B=document.getElementById("fakeLon"),D=document.getElementById("setFakeLoc"),z=document.getElementById("resumeRealGps"),H=document.getElementById("moveNorth"),j=document.getElementById("moveSouth"),U=document.getElementById("moveWest"),V=document.getElementById("moveEast"),Y=document.getElementById("removePoi"),q=document.getElementById("spawnPoiAtDevice"),I=document.getElementById("deviceCoords"),w=document.getElementById("poiCoords");D.addEventListener("click",()=>{const e=parseFloat(P.value),o=parseFloat(B.value);if(Number.isNaN(e)||Number.isNaN(o)){alert("Please enter valid numeric latitude / longitude values.");return}alert("Using fake input GPS, not real GPS location"),i.stopGps(),i.fakeGps(o,e)});z.addEventListener("click",()=>{alert("Resuming real GPS updates"),I.textContent="waiting for GPS…",i.startGps()});H.addEventListener("click",()=>f(l,0));j.addEventListener("click",()=>f(-l,0));U.addEventListener("click",()=>f(0,-l));V.addEventListener("click",()=>f(0,l));Y.addEventListener("click",Q);q.addEventListener("click",X);u.setAnimationLoop(J);function J(){m?.update(),u.render(d,r)}function h(){const e=new C(12,12,12),o=_.map(k=>new G({color:k,opacity:$,transparent:!0})),s=new F(e,o),p=new N({color:16777215,opacity:.3,transparent:!0}),y=new A(e);return s.add(new O(y,p)),s.name="Example POI",s}function x(){if(!a||!n)return;const[e,o]=i.lonLatToWorldCoords(t.longitude,t.latitude);n.position.x=e,n.position.z=o}function g(){P.value=t.latitude.toFixed(8),B.value=t.longitude.toFixed(8),a?w.textContent=`${t.latitude.toFixed(6)}°, ${t.longitude.toFixed(6)}°`:w.textContent="none"}function f(e,o){if(!a||!n){alert("The AR scene is still initialising. Try again when the red marker is visible.");return}const s=111132,p=Math.max(Math.cos(t.latitude*Math.PI/180)*s,1e-6);t.latitude+=e/s,t.longitude+=o/p,x(),g()}function K(e,o){Number.isFinite(e)&&Number.isFinite(o)&&(I.textContent=`${e.toFixed(6)}°, ${o.toFixed(6)}°`,c={latitude:e,longitude:o})}function Q(){if(!a||!n){alert("No cube to remove right now.");return}d.remove(n),n=null,a=!1,g()}function X(){if(!c){alert("Device location not available yet. Wait for GPS before spawning the cube.");return}a&&n&&d.remove(n),t.latitude=c.latitude,t.longitude=c.longitude,n=h(),i.add(n,t.longitude,t.latitude),a=!0,g()}
